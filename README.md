# th2-event-uploader (0.0.2)

The event-uploader application reads events content from a [jsonl](https://jsonlines.org/) file and publish it via [th2 common library](https://github.com/th2-net/th2-common-j)

## Command line arguments
You can get actual list of arguments by the command
```shell
./event-uploader --help
```
```text
usage: ./event-uploader [OPTIONS]
 -b,--event-book <arg>           Book is used for for events id building.
                                 `bookName` field from `box.json` config
                                 is used by default.
 -bs,--batch-size <arg>          Max batch size if number of events less
                                 than specified in 'event-in-batch' argument.
                                 Supported units: Byte ('262400' /
                                 '262400B'), Kilobyte ('256KB').
                                 Default value is 256KB
 -c,--th2-common-cfg-dir <arg>   Directory with th2 common configs
 -e,--events-file <arg>          JSONL file with events
 -h,--help                       Print commandline arguments
 -n,--event-in-batch <arg>       Max number of events in batch if
                                 calculated size less than specified in
                                 'batch-size' argument.
                                 Default value is 300 events
 -s,--event-scope <arg>          Scope is used for events id building.
                                 `boxName` field from `box.json` config is
                                 used by default.
```

## Events file format (*.jsonl)
The file with events should contain lines with the next format. event-uploader reads this file and transform each line to th2 event
```json
{
  "name": "My event name",
  "type": "My event type",
  "body": "{\"my-field\":123}",
  "attachedMessageIds": [
    {
      "book": "test_book",
      "alias": "my-message-alias",
      "group": "my-message-alias",
      "timestamp": 214302125226490,
      "sequence": 1
    }
  ]
}
```
* **_name_** (optional) - name for published event. Default value is `Unknown event name`.
* **_type_** (optional) - type for published event. Default value is `Unknown event type`.
* **_body_** (optional) - body for published event. Event is built without body if this field is missed.
* **_attachedMessageIds_** (optional) - list of attached message ids for published event. Event is built without attached messages if this field is missed.<br>
> Note: `book` filed in all messages must be the same as `-b/--event-book` cmd arg

## th2 common config (`-c/--th2-common-cfg-dir` cmd arg)

### box.json
This config contains default value for `book` and `scope` for published events
```json
{
  "bookName": "test_book",
  "boxName": "event-uploader"
}
```
* **_bookName_** - this value is used as event book by default if `-b/--event-book` argument isn't passed
* **_boxName_** - this value is used as event scope by default if `-s/--event-scope` argument isn't passed

### prometheus.json
Disable prometheus HTTP server embedded into th2 common library
```json
{
  "enabled": false
}
```

### mq.json
You should create th2 entry point component by the next CR and grab `mq.json` config generated by `th2-infra-operator` or `th2-pico` 
```yaml
apiVersion: th2.exactpro.com/v2
kind: Th2Box
metadata:
  name: script
spec:
  imageName: dev-script
  imageVersion: dev-script
  type: th2-script
  extendedSettings:
    k8sProbes: false
    externalBox:
      enabled: true
    hostNetwork: false
    service:
      enabled: false
```

### rabbitMQ.json
You should grab this config from th2 cluster or `th2-pico` you are going to connect 

## Release notes:

### 0.0.2
* added `-bs,--batch-size` optional argument
* set default value for `-n,--event-in-batch` option